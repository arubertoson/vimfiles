# ===========================================================================
# _vimrc.yaml * miv plugin manager setup file.
# Author: Marcus Albertsson (arubertoson@github.com)
# License: MIT license
# ===========================================================================
#
# CONTENTS
#
# |Visual
#   |Visual-Themes|
#   |Syntax-Filetypes|
#   |Visual-Enhancements|
#   |Distraction-Free|
#
# |Editing|
#   |Operators|
#   |Textobjects|
#   |Navigation|
#
# |Auto-Complete|
# |Syntax-Checkers|
# |Command-Palette|
# |Git|
# |Views|
# |Debugging-Executing|
# |Language-Specific|
#   |Python|
#   |C\Cpp|


plugin:

  # Playground
  #
  # Plugins here are not yet integrated, more for testing purposes

  # vim cool is essential as it will fix the nohls situation without rebinds.
  romainl/vim-cool: {}

  superfunc/usda-syntax: 
    script: |
      Gautocmd BufRead,BufNewFile *.{usd[a]} set filetype=usda
      Gautocmd FileType usda source $VIMPATH/miv/usda-syntax/vim/usda.vim

  suan/vim-instant-markdown: {}

  # iamcco/markdown-preview.vim:
  #   filetype: [markdown]

  # JamshedVesuna/vim-markdown-preview:
  #   filetype: [markdown]
  #   script: |
  #     let g:vim_markdown_preview_github=1
  #     let g:vim_markdown_preview_toggle=2
  #     " let g:vim_markdown_preview_hotkey="<C-m>"
  #     " let g:vim_markdown_preview_browser="google-chrome"

  #   euclio/vim-markdown-composer: {}
  # wellle/visual-split.vim:
  #   command:
  #     - VSResize
  #     - VSSplit
  #     - VSSplitAbove
  #     - VSSplitBelow

  # Shougo/vimproc.vim:
  #   build: make
  #   function: vimproc
  #   loadbefore:
  #     - quickrun

  # danro/rename.vim:
  #   command:
  #     - Rename
  # More operators for text objects
  # wellle/targets.vim: {}

  # rhysd/clever-f.vim: {}
  # chaoren/vim-wordmotion: {}

  yamahigashi/sendtomaya.vim:
    after: |
      let g:send_to_maya_host="localhost"
      let g:send_to_maya_port=12345
      let g:send_to_maya_prefer_language = 'python'

      vmap mayap <Plug>(SendToMayaPy)
      nmap <silent><Leader>aa :SendToMayaPy<Cr>

  simeji/winresizer:
    command:
      - WinResizerStartResize
    script: |
      let g:winresizer_vert_resize = 4
      let g:winresizer_horiz_resize = 1
      let g:winresizer_keycode_finish = char2nr('o')
      nnoremap <silent> <leader>wr :<C-u>WinResizerStartResize<CR>

  # ctrlf is a search tool for finding tags and providing smart renaming
  # across several files in project structure
  dyng/ctrlsf.vim:
    command:
      - CtrlSF


# ===========================================================================
# EDITING                                                           *Editing*

  # A comment code operator (gc<input>)
  tomtom/tcomment_vim: {}

  # Smart input provides auto-pairs like behaviour to complete ()[]{} and other
  # inputs that require a secondary input to be considdered complete.
  kana/vim-smartinput:
    insert: true

  # Provides a way to add, delete, switch surrounding brackets [test]->(test)
  machakann/vim-sandwich: {}

  # Provides substition search %Subvert/facilit{y,ies}/building{,s}/g
  # Also provides and easy way to switch betweetn
  # snake_case/SnakeCase/snakeCase/snacke-case/SNACKE_CASE
  #   crs         crm       crs       srd         sru
  tpope/vim-abolish: {}

  # More for testing out code chunks and ideas
  Konfekt/vim-scratchpad:
    function: scratchpad#
    mapping:
      - <Plug>(ToggleScratchPad)
    script: |
      nmap <leader>fs <Plug>(ToggleScratchPad)
      command! -nargs=? Scratchpad call scratchpad#ToggleScratchPad(<q-args>)

  # =========================================================================
  # Auto Complete (Look into language server by microsoft)
  #
  # Nvim completion manager works well, does not require complex setup.
  roxma/nvim-completion-manager:
    insert: true

  Shougo/neco-vim:
    loadafter: nvim-completion-manager
    filetype: [vim]

  Shougo/neoinclude.vim:
    loadafter: nvim-completion-manager
    filetype: [c, cpp, objc, objcpp]


# ===========================================================================
# VISUAL                                                      *Visual-Themes*

  # =========================================================================
  # Themes
  #
  # Light theme for prose/writing
  ajh17/Spacegray.vim: {}
  reedes/vim-colors-pencil: {}
  trevordmiller/nova-vim: {}
  rakr/vim-one: {}
  # Dark red based theme
  mhinz/vim-janah:
    before: highlight Normal ctermbg=235
  # Dark cyan based theme
  ayu-theme/ayu-vim: {}
    # script: |
    #   let g:ayucolor="mirage"
    #   Gautocmd ColorScheme *
    #     \  hi ALEErrorSign   guifg=#FF3333 guibg=#242B38 gui=bold
    #     \| hi ALEWarningSign guifg=#FFCC66 guibg=#242B38 gui=bold

  # =========================================================================
  # Statusbar
  #
  # For statusline display, gitbranch provides a simple function to return
  # current active branch. Lighlight will draw the statusline with the given
  # options.
  itchyny/vim-gitbranch: {}
  itchyny/lightline.vim:
    script: |
      let g:lightline = {
      \ 'enable': {
      \ 'tabline': 0,
      \ },
      \ 'colorscheme': 'wombat',
      \ 'active': {
      \   'left':  [
      \              ['gitbranch', 'paste'],
      \              ['readonly', 'modified'],
      \            ],
      \   'right': [
      \              ['percent', 'lineinfo'],
      \              ['filetype', 'fileencoding', 'fileformat'],
      \              ['linter_errors', 'linter_warnings', 'linter_ok'],
      \            ]
      \ },
      \ 'inactive': {
      \   'left':  [
      \              ['filename'],
      \            ],
      \   'right': [
      \              ['lineinfo'],
      \              ['percent'],
      \            ]
      \ },
      \ 'component_expand': {
      \   'linter_warnings': 'LightlineLinterWarnings',
      \   'linter_errors': 'LightlineLinterErrors',
      \   'linter_ok': 'LightlineLinterOK'
      \ },
      \ 'component_type': {
      \   'readonly': 'error',
      \   'linter_warnings': 'warning',
      \   'linter_errors': 'error',
      \ },
      \ 'component_function': {
      \   'gitbranch': 'gitbranch#name'
      \ },
      \ }
      Gautocmd User ALELint call lightline#update()

      function! LightlineLinterErrors() abort
        let l:counts = ale#statusline#Count(bufnr(''))
        let l:all_errors = l:counts.error + l:counts.style_error
        let l:all_non_errors = l:counts.total - l:all_errors
        return l:counts.total == 0 ? '' : printf('x %d', all_errors)
      endfunction

      function! LightlineLinterWarnings() abort
        let l:counts = ale#statusline#Count(bufnr(''))
        let l:all_errors = l:counts.error + l:counts.style_error
        let l:all_non_errors = l:counts.total - l:all_errors
        return l:counts.total == 0 ? '' : printf('▲ %d', all_non_errors)
      endfunction

      function! LightlineLinterOK() abort
        let l:counts = ale#statusline#Count(bufnr(''))
        let l:all_errors = l:counts.error + l:counts.style_error
        let l:all_non_errors = l:counts.total - l:all_errors
        return l:counts.total == 0 ? '♦ Ok' : ''
      endfunction


  # =========================================================================
  # General Syntax Plugin
  #
  sheerun/vim-polyglot: {}

  # =========================================================================
  # Distraction Free Mode
  #
  # Goyo tries to imitate a distraction free mode that would let you focus
  # better, it puts your work in center and removes distracting elements from
  # the view.
  junegunn/goyo.vim:
    command: Goyo
    before: |
      function! s:goyo_enter() abort
        let b:quitting = 0
        let b:quitting_bang = 0
        autocmd QuitPre <buffer> let b:quitting = 1
        cabbrev <buffer> q! let b:quitting_bang = 1 <bar> q!
      endfunction

      function! s:goyo_leave() abort
        if b:quitting && len(filter(range(1, bufnr('$')), 'buflisted(v:val)')) == 1
          if b:quitting_bang
            qa!
          else
            qa
          endif
        endif
      endfunction

      autocmd! User GoyoEnter call <SID>goyo_enter()
      autocmd! User GoyoLeave call <SID>goyo_leave()
    script: |
      nnoremap <silent><Leader>Td :<C-u>Goyo<CR>

  # limelight puts more focus on given textblocks by turning off syntax or
  # making not active paragrapghs darker.
  junegunn/limelight.vim:
    command: Limelight
    after: |
      autocmd! User GoyoEnter Limelight
      autocmd! User GoyoLeave Limelight!
    script: |
      nnoremap <silent><Leader>Tl :<C-u>Limelight!<CR>

  # =========================================================================
  # Visual Enhancements
  #
  # The responsive tabline is simply a visual enahncement on the labeling, it
  # will also stretch the columns to fit onto the vertical buffer.
  yami-beta/vim-responsive-tabline: {}

  # Parenmtach will highlight matched parens, it's faster than the built in.
  itchyny/vim-parenmatch:
    after: |
      let g:loaded_matchparen = 1
      highlight! link MatchParen ParenMatch

  # Cursor word will highlight all matching words in the buffer
  itchyny/vim-cursorword:
    script: |
      augroup cursorword-filetype
        autocmd!
        autocmd FileType qf,denite,vimfiler,vimshell,thumbnail,vimcalc,quickrun,calendar let b:cursorword = 0
        autocmd InsertEnter * let b:cursorword = 0
        autocmd InsertLeave * let b:cursorword = 1
      augroup END
  # display indentguides ¦ ┆ │ ⎸ ▏

  # Show indentation level
  Yggdroot/indentLine:
    script: |
      let g:indentLine_char = '¦'
      let g:indentLine_showFirstIndentLevel = 0
      let g:indentLine_leadingSpaceChar = '·'
      let g:indentLine_leadingSpaceEnabled = 1
      let g:indentLine_setColors = 0
      let g:indentLine_fileTypeExclude = ['md', 'markdown', 'json']

  # Highlight yanked areas
  machakann/vim-highlightedyank:
    mapping:
      - <Plug>(highlightedyank)
    script: |
      map y <Plug>(highlightedyank)
      highlight link HighlightedyankRegion Visual
      let g:highlightedyank_highlight_duration = 100


# ===========================================================================
# SYNTAX-CHECKERS                                           *Syntax-Checkers*

  # Helps clean up white space in file, this should not be necessary as I
  # utilize formatters to handle whitespace, but when working with other text or
  # file types it is handy.
  csexton/trailertrash.vim:
    command:
      - TrailerTrim
      - TrailerToggle

  # A collection of syntaxcheckers
  w0rp/ale:
    script: |
      nmap <silent> <leader>el <Plug>(ale_toggle)
      nmap <silent> <leader>ef <Plug>(ale_fix)
      nmap <silent> <leader>en <Plug>(ale_next_wrap)
      nmap <silent> <leader>ep <Plug>(ale_previous_wrap)
    before: |
      let g:ale_sign_error = '►'
      let g:ale_sign_warning = '»'
      let g:ale_statusline_format = ['× %d', '∆ %d', '♦ ok']

      let g:ale_lint_on_text_changed = 0
      let g:ale_lint_on_insert_leave = 0
      let g:ale_lint_on_save = 1
      let g:ale_lint_on_enter = 1

      let g:ale_linters = {
        \ 'sh': ['shell', 'shellcheck'],
        \ 'bash': ['shell', 'shellcheck'],
        \ 'zsh': ['shell', 'shellcheck'],
        \ }
      let g:ale_fixers = {
        \ 'python': ['yapf'],
        \ }
      let g:ale_fix_on_save = 1


# ===========================================================================
# COMMAND_PALETTE                                           *Command-Palette*

  Shougo/denite.nvim:
    command:
      - Denite
      - DeniteProjectDir
      - DeniteCursorWord
    script: |
      nnoremap <silent> <leader>pf :DeniteProjectDir file_rec/git<cr>

      nnoremap <silent> <leader>sg :<C-u>Denite grep<CR>
      nnoremap <silent> <leader>sf :<C-u>Denite file_rec<CR>
      nnoremap <silent> <leader>ss :<C-u>Denite line -buffer-name=search<CR>
      nnoremap <silent> <leader>as :<C-U>Denite file_rec -path=$VIMPATH<CR>

      nnoremap <silent> <leader>bb :<C-u>Denite buffer<CR>
      nnoremap <silent> <leader>ft :<C-u>Denite filetype<CR>
      nnoremap <silent> <leader><leader> :<C-u>Denite command<CR>
      nnoremap <silent> <leader>` :<C-u>Denite command_history<CR>
    after: |
      call denite#custom#option('_', {
        \ 'prompt': '❯',
        \ 'empty': 1,
        \ 'winheight': 10,
        \ 'short_source_names': 1,
        \ 'vertical_preview': 1,
        \ 'updatetime': 10,
        \ })
      call denite#custom#filter('matcher_ignore_globs', 'ignore_globs', [
        \ '.git/', '__pycache__/', '*.py[cd]'
        \ ])

      if executable('rg')
        call denite#custom#var('grep', 'command', ['rg'])
        call denite#custom#var('grep', 'recursive_opts', [])
        call denite#custom#var('grep', 'final_opts', ['.'])
        call denite#custom#var('grep', 'separator', ['--'])
        call denite#custom#var('grep', 'default_opts',
          \ ['--maxdepth', '8', '--vimgrep', '--no-heading'])
      endif
      call denite#custom#var('file_rec', 'command', ['rg', '--files'])

      " Sources
      call denite#custom#source('buffer', 'sorters', ['sorter_reverse'])
      call denite#custom#source('file_rec', 'sorters', ['sorter_sublime'])
      call denite#custom#source('file_rec', 'matchers', ['matcher_substring'])
      call denite#custom#source('file_mru', 'matchers', ['matcher_project_files',
        \ 'matcher_substring'])
      call denite#custom#source('file_mru,file_rec,buffer', 'converters',
        \ ['converter_relative_word'])

      call denite#custom#alias('source', 'file_rec/git', 'file_rec')
      call denite#custom#var('file_rec/git', 'command',
        \ ['git', 'ls-files', '--others', '--cached', '--exclude-standard'
        \ ])

      " Mappings
      call denite#custom#map('normal', 'q',        '<denite:quit>',                        'noremap')
      call denite#custom#map('normal', '<Esc>',    '<denite:quit>',                        'noremap')
      call denite#custom#map('normal', '-',        '<denite:choose_action>',               'noremap')
      call denite#custom#map('normal', 'd',        '<denite:do_action:delete>',            'noremap')
      call denite#custom#map('normal', 'o',        '<denite:do_action:default>',           'noremap')
      call denite#custom#map('normal', 'f',        '<denite:do_action:find>',              'noremap')
      call denite#custom#map('normal', 'r',        '<denite:do_action:reset>',             'noremap')
      call denite#custom#map('normal', 'u',        '<denite:do_action:update>',            'noremap')
      call denite#custom#map('normal', '<C-v>',    '<denite:do_action:vsplit>',            'noremap')

      call denite#custom#map('insert', '<C-o>',    '<denite:choose_action>',               'noremap')
      call denite#custom#map('insert', 'jk',       '<denite:enter_mode:normal>',           'noremap')
      call denite#custom#map('insert', '<C-v>',    '<denite:do_action:vsplit>',            'noremap')
      call denite#custom#map('insert', '<C-a>',    '<denite:move_caret_to_head>',          'noremap')
      call denite#custom#map('insert', '<C-i>',    '<denite:move_caret_to_tail>',          'noremap')

      call denite#custom#map('insert', '<C-n>',    '<denite:move_to_next_line>',           'noremap')
      call denite#custom#map('insert', '<C-p>',    '<denite:move_to_previous_line>',           'noremap')
      "call denite#custom#map('insert', '<C-p>',    '<denite:paste_from_default_register>', 'noremap')
      "call denite#custom#map('insert', '<C-d>',    '<denite:delete_char_before_caret>',    'noremap')

      autocmd! Syntax denite
        \  highlight! default link deniteStatusLinePath   StatusLine
        \| highlight! default link deniteStatusLineNumber StatusLine


# ===========================================================================
# GIT                                                                   *Git*

  # Gutter signs for git diff
  mhinz/vim-signify: {}

  # Git log/diff viewer
  cohama/agit.vim:
    command:
      - Agit
      - AgitFile
      - AgitDiff

  # Magit inspired git interface in vim
  jreybert/vimagit:
    command:
      - Magit
    script: |
      let g:magit_default_show_all_files = 0

  # Save sessions with branches
  ToruIwashita/git-switcher.vim:
    script: |
      let g:gsw_sessions_dir = expand('$XDG_CACHE_HOME/git_switcher/')
      let g:gsw_autoload_session = 'yes'
      let g:gsw_autodelete_sessions_if_branch_not_exist = 'confirm'

# ===========================================================================
# VIEWS                                                               *Views*

  mbbill/undotree:
    command:
      - UndotreeToggle
    script: |
      nnoremap <silent> ,u :<C-u>call UndotreeMyToggle()<CR>
      Gautocmdft undotree,diff setlocal nonu nornu colorcolumn=
      function! UndotreeMyToggle() abort
        if &l:filetype != 'php'
          let s:undotreeLastFiletype = &l:filetype
          MyAutoFT diff MyAuto BufEnter,WinEnter <buffer>
            \ let &l:syntax = s:undotreeLastFiletype
        endif
        UndotreeToggle
      endfunction
    before: |
      let g:undotree_WindowLayout = 4
      let g:undotree_SplitWidth = 36
      let g:undotree_SetFocusWhenToggle = 1
      function! g:Undotree_CustomMap() abort
        nmap <buffer> o <Enter>
        nmap <buffer> u <Plug>UndotreeUndo
        nmap <buffer> r <Plug>UndotreeRedo
        nmap <buffer> h <Plug>UndotreeGoNextState
        nmap <buffer> l <Plug>UndotreeGoPreviousState
        nmap <buffer> d <Plug>UndotreeDiffToggle
        nmap <buffer> t <Plug>UndotreeTimestampToggle
        nmap <buffer> C <Plug>UndotreeClearHistory
      endfunction
      Gautocmdft diff Gautocmd BufEnter,WinEnter <buffer>
        \  nnoremap <silent> <buffer> q :<C-u>UndotreeHide<CR>
        \| nnoremap <silent> <buffer> ` :<C-u>UndotreeHide<CR>


# ===========================================================================
# DEBUGGING-EXECUTING                                   *Debugging-Executing*

  thinca/vim-prettyprint: {}
  thinca/vim-quickrun:
    command: QuickRun
    script: |
      nnoremap <silent> <F8> :<C-u>QuickRun<CR>


# ===========================================================================
# LANGUAGE-SPECIFIC                                       *Language-Specific*

  # *Python*
  davidhalter/jedi-vim:
    filetype: python
    script: |
      let g:jedi#completions_enabled = 0
      let g:jedi#auto_vim_configuration = 0
      let g:jedi#smart_auto_mappings = 0
      let g:jedi#show_call_signatures = 0
      let g:jedi#use_splits_not_buffers = 1
  fisadev/vim-isort:
    command: Isort
    filetype: python
    script: |
      let g:vim_isort_map = ''


# ===========================================================================
# FILETYPES                                                       *Filetypes*
filetype:

  python: |
    nnoremap <buffer> <leader>gt :call jedi#goto()<CR>
    nnoremap <buffer> <leader>ga :call jedi#goto_assignments()<CR>
    nnoremap <buffer> <leader>gd :call jedi#goto_definitions()<CR>
    nnoremap <buffer> <leader>gu :call jedi#usages()<CR>
    nnoremap <buffer> <leader>gr :call jedi#rename()<CR>
    vnoremap <buffer> <leader>gr :call jedi#rename_visual()<CR>
    nnoremap <buffer> K :call jedi#show_documentation()<CR>
    " let g:ale_python_pylint_options = "--init-hook=\"import sys; sys.path.append('C:/Program Files/Autodesk/Maya2017/devkit/other/pymel/extras/completion/py')\""


# ===========================================================================
# HOOK-ON-SOURCE                                             *Hook-on-source*

before: |
  " Set default theme and other themes that we can change to
  let g:vimrc#theme = 'icode'
  let g:vimrc#themes = {
    \   'iwrite': { 'colorscheme': 'pencil',
    \              'background': 'light',
    \              'font-size': '14',
    \              'linespace': '6',
    \              'typeface': 'Cousine',
    \               },
    \   'icode': { 'colorscheme': 'one',
    \              'background': 'dark',
    \              'font-size': '12',
    \              'linespace': '3',
    \              'typeface': 'Droid Sans Mono',
    \              'callback': 'let g:indentLine_setColors = 1'
    \               },
    \   'icode-janah': { 'colorscheme': 'janah',
    \              'background': 'dark',
    \              'font-size': '12',
    \              'linespace': '3',
    \              'typeface': 'Droid Sans Mono',
    \              'callback': 'let g:indentLine_setColors = 1'
    \               },
    \ }


# ===========================================================================
# HOOK-AFTER-SOURCE                                       *Hook-after-source*

after: |
  if !has('gui_running')
    SetColorScheme icode
    " execute 'colorscheme' get(
    "   \ g:vimrc#themes[g:vimrc#theme], 'colorscheme', 'desert')
  endif
